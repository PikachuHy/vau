<!DOCTYPE html>
<html>
<head>
<script type='text/javascript'>
var VauWasm = {
  	preRun: [function () {
		var status = document.getElementById("status");
		status.innerHTML = "INITIALIZING...";
  	}], 
  	logReadFiles: true,
  	postRun: [function () {
		var status = document.getElementById("status");
		status.innerHTML = "READY.";
		runViewer();
  	}]
};

function allocateUTF8(str) {
	var size = lengthBytesUTF8(str) + 1;
	var pointer = _malloc(size);
	stringToUTF8(str, pointer, size);
	return pointer;
}

function openDocument(str) {
	var p= allocateUTF8(str);
	_wasm_open_document(p);
	_free(p)
}

function updateImage() { 
	var doc = FS.readFile("/vau-test.png");
	var img = document.getElementById("image");
	img.src = URL.createObjectURL(new Blob([doc], { type: "image/png" }));
}

function showPage(n) {
	_wasm_get_page_png(n);
	updateImage();
	var status = document.getElementById("status");
	status.innerHTML = `Page ${n}.`;
}


</script>
<script src="Vau.js"></script>
</head>
<body>
<div id="status">LOADING...</div>
<img id="image" width="500px">
</body>
<script>
	var page=1;

	function runViewer() {
		openDocument("$TEXMACS_PATH/vau-tests/grassmann-sq-example.tm");
		showPage(page);

		window.addEventListener("keydown", function (event) {
			console.log(event);
			if (event.key == "PageDown") {
				showPage(page);
				console.log("PAGEDOWN");
				page= page+1;
			    showPage(page);
				event.preventDefault();
			}
			if (event.key == "PageUp") {
				console.log("PAGEUP");
				if (page > 1) {
					page= page-1;
			    	showPage(page);
				}
				event.preventDefault();
			}
		});
	}
</script>
</html>
